name: UI-Act Tests

on:
  workflow_dispatch:

jobs:
  run-tests:
    runs-on: proxmox
    steps:
      - uses: actions/checkout@v4
      # Build deb package
      - run: make package
      # Install deb
      - run: sudo apt install ./ui-act_*.deb
      # Restart gnome before the extension can be enabled
      - run: sudo systemctl restart gdm3 && gnome-extensions enable ui-act@tobiasnorlund.github.com
      # Set api key and disable telemetry
      - run: gsettings --schemadir /usr/share/gnome-shell/extensions/ui-act@tobiasnorlund.github.com/schemas set org.gnome.shell.extensions.ui-act telemetry-enabled false
      - run: gsettings --schemadir /usr/share/gnome-shell/extensions/ui-act@tobiasnorlund.github.com/schemas set org.gnome.shell.extensions.ui-act anthropic-api-key ${{ secrets.ANTHROPIC_API_KEY }}
      # Test setting
      - run: gsettings --schemadir /usr/share/gnome-shell/extensions/ui-act@tobiasnorlund.github.com/schemas get org.gnome.shell.extensions.ui-act telemetry-enabled
